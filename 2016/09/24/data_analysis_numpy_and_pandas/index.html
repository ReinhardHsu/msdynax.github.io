






    
      
    

<!doctype html>
<html lang="">
<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <meta name="author" content="Reinhard Hsu">
  
  
  
  
    <meta name="description" content="一维数据NumPy（Numerical Python）

Array：使用较为简单

Pandas

Series：是基于NumPy的Array，但是提供了更多的特性

NumPy数组中的元素应该有着相同的数据类型可以使用遍历数组中的元素可以切片，a[1:3]，索引1和2的两个元素提供了方便的函数，如mean()，std(),max(),min()可以是多维的
argmax()可以回去最大值...">
  
  <title>Data Analysis NumPy和Pandas - Reinhard Hsu</title>
  
  
    <link rel="shortcut icon" href="../../../../favicon.ico">
  
  
  <link rel="stylesheet" href="../../../../css/random.css">
<link rel="stylesheet" href="../../../../css/vegas.min.css">
<link rel="stylesheet" href="../../../../css/highlight-railscasts.css">
<link rel="stylesheet" href="../../../../css/jquery.fancybox.css">
<link rel="stylesheet" href="../../../../css/iconfont/iconfont.css">
<link rel="stylesheet" href="../../../../css/jquery.fancybox-thumbs.css">
<link rel="stylesheet" href="../../../../css/plyr.css">
  
  
  <script>
// is trigger analytics / tongji script
var isIgnoreHost = false;

if(window && window.location && window.location.host) {
  isIgnoreHost = ["localhost","127.0.0.1"].some(function(address){
    return 0 === window.location.host.indexOf(address);
  });
}

var isTriggerAnalytics = !( true && isIgnoreHost );

</script>

  
    </script>
<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-119133633-1"></script>
<script>
if(isTriggerAnalytics) {
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-119133633-1');
 }
</script>
  
</head>

<body>
<div class="side-navigate hide-area">
  
    <div class="item prev">
      <a href="../../25/data_analysis_commucating_data_art/">
        <div class="item-icon"></div>
      </a>
      <div class="item-title">
        Data Analysis 数据交流的艺术
      </div>
    </div>
  
  
    <div class="item next">
      <a href="../../19/data_analysis_different_roles_of_bi_field/">
        <div class="item-icon"></div>
      </a>
      <div class="item-title">
        Data Analysis 商业智能领域里的不同角色
      </div>
    </div>
  
</div>
<div id="outer-container" class="hide-area">
<div id="container">
  <div id="menu-outer" class="slide-down">
    <div id="menu-inner">
      <div id="brand">
        
        <a onClick="openUserCard()">
          <img id="avatar" src="http://ReinhardHsu.com/images/ReinhardHsu.png"/>
          <div id="homelink">Reinhard Hsu</div>
        </a>
      </div>
      <div id="menu-list">
        <ul>
        
        
          
            <li>
          
            
              <li><a href="/">Home</a></li>
            
            
          </li>
        
          
            <li>
          
            
              <a href="http://www.cnblogs.com/msdynax">Blog</a>
            
            
          </li>
        
          
            <li>
          
            
              <a href="../../../../archives">Archives</a>
            
            
          </li>
        
          
            <li>
          
            
              <a href="../../../../tags">Tags</a>
            
            
          </li>
        
          
            <li>
          
            
              <a href="../../../../categories">Categories</a>
            
            
          </li>
        
          
            <li>
          
            
              <a href="../../../../about">About</a>
            
            
          </li>
        
          
            <li>
          
            
              <a href="../../../../game.html">Game</a>
            
            
          </li>
        
        </ul>
      </div>
      <div id="show-menu">
        <button>Menu</button>
      </div>
    </div>
  </div>

  <div id="content-outer">
    <div id="content-inner">
      
      
  <article id="post">
    <h1>Data Analysis NumPy和Pandas</h1>
    <p class="page-title-sub">
      <span id = "post-title-date">Created at 2016-09-24</span>
      
        <span id = "post-title-updated">Updated at 2018-05-01</span>
      
      
      <span id = "post-title-categories">Category
      
      
        
        
        <a href="../../../../categories/data-analysis/">Data Analysis</a>
      
      </span>
      
      
      <span id = "post-title-tags">
      Tag
      
      
        
        
        <a href="../../../../tags/data-analysis/">Data Analysis</a>
      
        
          /
        
        
        <a href="../../../../tags/python/">Python</a>
      
        
          /
        
        
        <a href="../../../../tags/numpy/">NumPy</a>
      
        
          /
        
        
        <a href="../../../../tags/pandas/">Pandas</a>
      
      </span>
      
    </p>
    
    <h2 id="一维数据"><a href="#一维数据" class="headerlink" title="一维数据"></a>一维数据</h2><p>NumPy（Numerical Python）</p>
<ul>
<li>Array：使用较为简单</li>
</ul>
<p>Pandas</p>
<ul>
<li>Series：是基于NumPy的Array，但是提供了更多的特性</li>
</ul>
<h3 id="NumPy"><a href="#NumPy" class="headerlink" title="NumPy"></a>NumPy</h3><p>数组中的元素应该有着相同的数据类型<br>可以使用遍历数组中的元素<br>可以切片，a[1:3]，索引1和2的两个元素<br>提供了方便的函数，如mean()，std(),max(),min()<br>可以是多维的</p>
<p>argmax()可以回去最大值的索引</p>
<h4 id="向量运算，线性代数"><a href="#向量运算，线性代数" class="headerlink" title="向量运算，线性代数"></a>向量运算，线性代数</h4><p>这部分其实大学的线性代数课程里都讲过了，和大家再回忆下，温故而知新。<br>向量相加<br>1,2,3 + 4,5,6 = 5,7,9<br>如果是Python中的列表相加<br>1,2,3 + 4,5,6 = 1,2,3,4,5,6  </p>
<p>向量乘以一个数字<br>1,2,3 <em> 3 = 3,6,9<br>如果是Python中的列表乘以一个数字<br>1,2,3 </em> 3 = 1,2,3,1,2,3,1,2,3  </p>
<p>在NumPy中，a&amp;b执行 按位与 运算，它和 逻辑于 不一定相同。但是如果数据类型是布尔型的话，那么按位与和逻辑与的作用是一样的。<br>可以用np.logical_and(a,b)对整数向量进行逻辑与运算。也可以先把整数转换成布尔向量。<br>类似，a|b执行按位或，~a执行按位非。如果是布尔向量，那么逻辑或和逻辑非的效果一样。  </p>
<h4 id="索引数组"><a href="#索引数组" class="headerlink" title="索引数组"></a>索引数组</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">b=[<span class="keyword">False</span>,<span class="keyword">False</span>,<span class="keyword">True</span>,<span class="keyword">True</span>,<span class="keyword">True</span>]  </span><br><span class="line"></span><br><span class="line">a[b]=[<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]  </span><br><span class="line">a[a&gt;<span class="number">2</span>]=[<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]  </span><br><span class="line">a&gt;<span class="number">4</span>  =[<span class="keyword">False</span>,<span class="keyword">False</span>,<span class="keyword">False</span>,<span class="keyword">False</span>,<span class="keyword">True</span>]</span><br></pre></td></tr></table></figure>
<h4 id="vs"><a href="#vs" class="headerlink" title="+ vs +="></a>+ vs +=</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">b=a</span><br><span class="line">a=a+np.array([<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>])</span><br><span class="line"><span class="keyword">print</span> b</span><br><span class="line"></span><br><span class="line">a=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">b=a</span><br><span class="line">a+=np.array([<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>])</span><br><span class="line"><span class="keyword">print</span> b</span><br></pre></td></tr></table></figure>
<p>这里，a和b指向同一块内存，a=a+？？，会创建一个新的数组，a指向了新的，b指向的还是之前的。<br>而+=，原位运算，会将新值存储在原来的地址。</p>
<h4 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a=np.array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">slice=a[:<span class="number">2</span>]</span><br><span class="line">slice[<span class="number">0</span>]=<span class="number">100</span></span><br><span class="line"><span class="keyword">print</span> a</span><br></pre></td></tr></table></figure>
<p>这里，切片并没有创建一个新的数组，而是共享着a中的元素。所以切片非常快速，但是操作要十分小心。  </p>
<h3 id="Pandas"><a href="#Pandas" class="headerlink" title="Pandas"></a>Pandas</h3><p>Pandas的Series与NumPy的array十分相似，也可以切片，循环，向量操作，也是c实现的，比Python要快。</p>
<h4 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h4><p>Series比NumPy好的地方是，能够添加索引</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a=pd.Series([<span class="number">1</span>,<span class="number">2</span>],index=[<span class="string">'us'</span>,<span class="string">'zh'</span>])</span><br><span class="line">country_name=a.argmax()</span><br><span class="line"><span class="keyword">print</span> a.loc[country_name]</span><br></pre></td></tr></table></figure>
<p>如果没有指定索引，默认索引会是0，1，2.<br>而NumPy的Array是没有索引的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a=np.array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">a[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<p>NumPy Array的这里只能称为位置0，而不能称为索引0。  </p>
<ul>
<li>按索引，索引相同的才相加，而不是按位置。</li>
<li>索引不同的时候，会列出所有索引，相同的相加。一个里面有一个里面没的显示为NaN，非数字。</li>
<li>要去掉结果中的NaN，可以使用dropna()，结果只显示索引匹配的值。</li>
<li>如果一个有，一个没的也要保留，那么可以用add()，而不是用+ 。</li>
</ul>
<h4 id="如果想要的计算没有内建怎么办"><a href="#如果想要的计算没有内建怎么办" class="headerlink" title="如果想要的计算没有内建怎么办"></a>如果想要的计算没有内建怎么办</h4><ol>
<li>使用循环</li>
<li>使用类似于map的apply()，对每个元素进行计算。</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s+<span class="number">3</span></span><br><span class="line">s.apply(add3)</span><br></pre></td></tr></table></figure>
<h2 id="二维数组"><a href="#二维数组" class="headerlink" title="二维数组"></a>二维数组</h2><p>NumPy</p>
<ul>
<li>2D Array</li>
</ul>
<p>Pandas</p>
<ul>
<li>DataFrame</li>
</ul>
<h3 id="NumPy-1"><a href="#NumPy-1" class="headerlink" title="NumPy"></a>NumPy</h3><p>与Python中的list有点不同：</p>
<ol>
<li><a href="http://docs.scipy.org/doc/numpy/reference/arrays.ndarray.html#internal-memory-layout-of-an-ndarray" target="_blank" rel="noopener">更省内存</a></li>
<li>通过a[1,2]来访问元素，而不是 a [1] [2] 。</li>
<li>可以对整个数组进行mean()等运算</li>
</ol>
<h4 id="分片"><a href="#分片" class="headerlink" title="分片"></a>分片</h4><p>a[1:3,3:5]，取第2第3行的第4第5列，也就是4个元素。其中第2行的两个元素组成一个数组，第3行的两个元素组成一个数组。返回的结果类似于</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">1</span> ,<span class="number">2</span>],</span><br><span class="line">[<span class="number">3</span>,<span class="number">4</span>]]</span><br></pre></td></tr></table></figure>
<h4 id="运算"><a href="#运算" class="headerlink" title="运算"></a>运算</h4><p>对应位置的元素才会相互作用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a=np.array([</span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>],</span><br><span class="line">[<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">a[<span class="number">0</span>,:]+a[<span class="number">1</span>,:]=[<span class="number">4</span>,<span class="number">6</span>]</span><br><span class="line"></span><br><span class="line">a[:,<span class="number">0</span>]+a[:<span class="number">1</span>]=[<span class="number">3</span>,<span class="number">7</span>]</span><br></pre></td></tr></table></figure>
<h4 id="轴"><a href="#轴" class="headerlink" title="轴"></a>轴</h4><p>NumPy的array的方法中，可以指定轴，对行或列进行运算。如:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.mean(axis=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>就是对算每一行的平均值，结果是一个数组。</p>
<h4 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h4><p>NumPy的array中，所有元素的数据类型应该是一致的。否则，所有数据都会变成字符串。这样就没法进行数值运算。</p>
<h3 id="Pandas-1"><a href="#Pandas-1" class="headerlink" title="Pandas"></a>Pandas</h3><p>DataFrame中的每一列可以是不同类型。<br>DataFrame中的通过索引取的是行，列的话有列名</p>
<h4 id="分片-1"><a href="#分片-1" class="headerlink" title="分片"></a>分片</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">col_name=a.iloc[<span class="number">0</span>].argmax()</span><br><span class="line"><span class="keyword">print</span> a[col_name].mean()</span><br><span class="line"><span class="keyword">print</span> a.values.mean()</span><br><span class="line"><span class="keyword">print</span> a.mean()</span><br></pre></td></tr></table></figure>
<p>上面的例子是找到第1行中的最大值的列名。<br>然后打印出那一列的平均值。<br>接着打印出整个DataFrame中数值的平均值。<br>最后打印出每个数值列的平均值。   </p>
<h4 id="计算相关性，Pearson矩阵相关系数r"><a href="#计算相关性，Pearson矩阵相关系数r" class="headerlink" title="计算相关性，Pearson矩阵相关系数r"></a>计算相关性，Pearson矩阵相关系数r</h4><p>将变量x的每个值转换成标准偏差x_std，这一过程称为标准化。<br>将变量x的每个值转换成标准偏差y_std，这一过程称为标准化。<br>只有标准化后，x和y才有可比性。<br>然后两个标准偏差向量相乘，再求平均值 (x_std*y_std).mean()。  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x_std=(x-x.mean())/x.std(ddof=<span class="number">0</span>)</span><br><span class="line">y_std=(x-x.mean())/y.std(ddof=<span class="number">0</span>)</span><br><span class="line">r=(x_std*y_std).mean()</span><br></pre></td></tr></table></figure>
<p>这样就算出了皮尔逊矩阵的相关系数。<br>如果再坐标系中表示的话，如果x比x的平均值大1个标准偏差，y也比y的平均值大1个标准偏差，那么(x,y)的点就在第一象限，这样r就是正相关。如果x比x的平均值大，y比y的平均值小，那么就在第四象限，这样r就是负相关。<br>皮尔逊的矩阵相关系数r，介于-1和1之间，接近0时，说明相关性非常低。<br><a href="http://onlinestatbook.com/2/describing_bivariate_data/pearson.html" target="_blank" rel="noopener">扩充读物</a><br>因为std()默认使用贝塞耳矫正系数。需要使用ddof=0来禁用矫正。<br>其实NumPy中自带的有corrcoef()来计算皮尔逊矩阵的相关系数。  </p>
<h4 id="移动元素"><a href="#移动元素" class="headerlink" title="移动元素"></a>移动元素</h4><p>一个数组记录了总数，求增长</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a=pd.DataFrame([<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>])</span><br><span class="line">b=a.shift(<span class="number">1</span>)</span><br><span class="line"><span class="comment">#[NaN,10,11]</span></span><br><span class="line">a-b</span><br><span class="line"><span class="comment">#[NaN,1,1]</span></span><br></pre></td></tr></table></figure>
<p>这样将a数组中的元素向后移动一个位置，总容量还是3 。最后求出了增长。<br>除了shift()，用diff()求出的结果也是一模一样。</p>
<h4 id="applymap和apply"><a href="#applymap和apply" class="headerlink" title="applymap和apply"></a>applymap和apply</h4><p><code>NumPy的std默认是总体标准偏差，也就是ddof=0。而Pandas的std默认是样本标准偏差，也就是ddof=1。</code><br>applymap是对每个元素独立运算，比如85-100分是优秀<br>apply是对DataFrame的每个Series进行运算，比如得分排名比80%的同学都好时，得A。<br>Pandas中有一个qcut()，可以执行此类运算<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cut</span><span class="params">(data)</span></span></span><br><span class="line"><span class="function">  <span class="title">return</span> <span class="title">pd</span>.<span class="title">qcut</span><span class="params">(data,</span></span></span><br><span class="line"><span class="function"><span class="params">    [<span class="number">0</span>,<span class="number">0.6</span>,<span class="number">0.8</span>,<span class="number">1</span>],</span></span></span><br><span class="line"><span class="function"><span class="params">    labels=[<span class="string">'C'</span>,<span class="string">'B'</span>,<span class="string">'A'</span>])</span></span></span><br></pre></td></tr></table></figure></p>
<p><code>qcut只能操作list，array，Series。</code><br>如果要操作DataFrame，可以用apply，来对每一列调用qcute:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.apply(cut)</span><br></pre></td></tr></table></figure></p>
<p>apply()还能算每一列的最大值与第二大值<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">data.apply(np.max) = data.max()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">second</span><span class="params">(column)</span>:</span></span><br><span class="line">    sorted_column = column.sort_values(ascending=<span class="keyword">False</span>)</span><br><span class="line">    <span class="keyword">return</span> sorted_column.iloc[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> data.apply(second)</span><br></pre></td></tr></table></figure></p>
<h4 id="Series和DataFrame相加"><a href="#Series和DataFrame相加" class="headerlink" title="Series和DataFrame相加"></a>Series和DataFrame相加</h4><p>DataFrame和DataFrame相加我们都知道，对应位置的元素会相加。<br>但是Series和DataFrame相加呢？我们知道，Series是有index的概念的，也就是列名。只有Series和DataFrame列名匹配的元素，才会相加。</p>
<h4 id="向量运算"><a href="#向量运算" class="headerlink" title="向量运算"></a>向量运算</h4><p>之前我们用apply来对列做归一，现在如果用向量运算的话，会是这样<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">grades_df = pd.DataFrame(</span><br><span class="line">    data=&#123;<span class="string">'exam1'</span>: [<span class="number">43</span>, <span class="number">81</span>, <span class="number">78</span>, <span class="number">75</span>, <span class="number">89</span>, <span class="number">70</span>, <span class="number">91</span>, <span class="number">65</span>, <span class="number">98</span>, <span class="number">87</span>],</span><br><span class="line">          <span class="string">'exam2'</span>: [<span class="number">24</span>, <span class="number">63</span>, <span class="number">56</span>, <span class="number">56</span>, <span class="number">67</span>, <span class="number">51</span>, <span class="number">79</span>, <span class="number">46</span>, <span class="number">72</span>, <span class="number">60</span>]&#125;,</span><br><span class="line">    index=[<span class="string">'Andre'</span>, <span class="string">'Barry'</span>, <span class="string">'Chris'</span>, <span class="string">'Dan'</span>, <span class="string">'Emilio'</span>,</span><br><span class="line">           <span class="string">'Fred'</span>, <span class="string">'Greta'</span>, <span class="string">'Humbert'</span>, <span class="string">'Ivan'</span>, <span class="string">'James'</span>]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">standardize=(df-df.mean())/df.std(ddof=<span class="number">0</span>)</span><br></pre></td></tr></table></figure></p>
<p>如果对行做归一的话，向量运算会是这样<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">col_mean= df.mean(axis=<span class="string">'columns'</span>)</span><br><span class="line">col_sub=df.sub(col_mean, axis=<span class="string">'index'</span>)</span><br><span class="line">col_std=df.std(ddof=<span class="number">0</span>,axis=<span class="string">'columns'</span>)</span><br><span class="line">standardize_rows=col_sub.div(col_std, axis=<span class="string">'index'</span>)</span><br></pre></td></tr></table></figure></p>
<h4 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"></span><br><span class="line">filename = <span class="string">'/Users/reinhard/subway_weather.csv'</span></span><br><span class="line">subway_df = pd.read_csv(filename)</span><br><span class="line"></span><br><span class="line">mean_hour=subway_df.groupby(<span class="string">'hour'</span>)[<span class="string">'ENTRIESn_hourly'</span>].mean()</span><br><span class="line"><span class="keyword">print</span> mean_hour</span><br><span class="line">plt.plot(mean_hour)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">mean_day_week=subway_df.groupby(<span class="string">'day_week'</span>)[<span class="string">'ENTRIESn_hourly'</span>].mean()</span><br><span class="line">plt.plot(mean_day_week)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p>默认分组完毕后，用户分组的条件，会跑到index上去，不再是column了。可以使用<em>as_index=False</em>来将分组条件留在column上。</p>
<h4 id="合并多个DataFrame"><a href="#合并多个DataFrame" class="headerlink" title="合并多个DataFrame"></a>合并多个DataFrame</h4><p>如果两个DataFrame的关联列有相同的列名</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data1.merge(data2,on=[<span class="string">'col1'</span>,<span class="string">'col2'</span>],how=<span class="string">'inner'</span>)</span><br></pre></td></tr></table></figure>
<p>如果列名不一样</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data1.merge(data2,left_on=[<span class="string">'col1'</span>,<span class="string">'col2'</span>],right_on=[<span class="string">'col3'</span>,<span class="string">'col4'</span>],how=<span class="string">'inner'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="用散点图展示"><a href="#用散点图展示" class="headerlink" title="用散点图展示"></a>用散点图展示</h4><p>散点图有一些参数，c是颜色,s是大小,alpha是透明度<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">way= subway_df.groupby([<span class="string">'latitude'</span>,<span class="string">'longitude'</span>],as_index=<span class="keyword">False</span>)[<span class="string">'ENTRIESn_hourly'</span>].mean()</span><br><span class="line"><span class="keyword">print</span> way</span><br><span class="line">s=way[<span class="string">'ENTRIESn_hourly'</span>]/way[<span class="string">'ENTRIESn_hourly'</span>].std()</span><br><span class="line">plt.scatter(way[<span class="string">'latitude'</span>],way[<span class="string">'longitude'</span>],s=s*<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure></p>
<h4 id="处理缺失值"><a href="#处理缺失值" class="headerlink" title="处理缺失值"></a>处理缺失值</h4><p>df.fillna(0)会用0值替换整个数据框中所有列的缺失值。<br>df[‘CollumnName’].fillna(0,inplace=True)，指替换指定列的缺失值。</p>
<h3 id="三维数据"><a href="#三维数据" class="headerlink" title="三维数据"></a>三维数据</h3><h4 id="NumPy-2"><a href="#NumPy-2" class="headerlink" title="NumPy"></a>NumPy</h4><p>array可以这样表示多维数据。一维：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=np.array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br></pre></td></tr></table></figure>
<p>二维:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a=np.array([</span><br><span class="line">  [<span class="number">1</span>,<span class="number">2</span>],</span><br><span class="line">  [<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<p>三维:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a=np.array([</span><br><span class="line">  [[<span class="number">1</span>,<span class="number">2</span>],[<span class="number">3</span>,<span class="number">4</span>]],</span><br><span class="line">  [[<span class="number">5</span>,<span class="number">6</span>],[<span class="number">7</span>,<span class="number">8</span>]]</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<h4 id="Pandas-2"><a href="#Pandas-2" class="headerlink" title="Pandas"></a>Pandas</h4><p><a href="http://pandas.pydata.org/pandas-docs/stable/dsintro.html#panel" target="_blank" rel="noopener">Panels</a>用于表示三维数据</p>
<div><h1>推荐文章<span style="font-size:0.45em; color:gray">（由<a href="https://github.com/huiwang/hexo-recommended-posts">hexo文章推荐插件</a>驱动）</span></h1><ul><li><a href="http://reinhardhsu.com/2017/07/17/career_richdad_team_ppdai_magic_mirror_cup_second_fintech_data_application_competition/">Career 祝贺富爸爸队的投资分析作品成功进入拍拍贷魔镜杯复赛阶段</a></li><li><a href="http://reinhardhsu.com/2016/09/25/data_analysis_commucating_data_art/">Data Analysis 数据交流的艺术</a></li><li><a href="http://reinhardhsu.com/2016/09/19/data_analysis_different_roles_of_bi_field/">Data Analysis 商业智能领域里的不同角色</a></li><li><a href="http://w23ta0.github.io/2015/11/18/Error-command-gcc-failed-with-exit-status-1-when-installing-MySQLdb-under-centos6-6.html">Centos6下安装MySQLdb时出现“error: command 'gcc' failed with exit status 1</a></li></ul></div>
  </article>
  <div class="random-toc-area">
  <button class="btn-hide-toc btn-hide-toc-show" style="display: none" onclick="TOCToggle()">Show TOC</button>
  <button class="btn-hide-toc btn-hide-toc-hide" onclick="TOCToggle()">Hide TOC</button>
  <div class="random-toc">
    <h2>Table of Content</h2>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一维数据"><span class="toc-text">一维数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NumPy"><span class="toc-text">NumPy</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#向量运算，线性代数"><span class="toc-text">向量运算，线性代数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#索引数组"><span class="toc-text">索引数组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vs"><span class="toc-text">+ vs +=</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#切片"><span class="toc-text">切片</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pandas"><span class="toc-text">Pandas</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#索引"><span class="toc-text">索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#如果想要的计算没有内建怎么办"><span class="toc-text">如果想要的计算没有内建怎么办</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二维数组"><span class="toc-text">二维数组</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NumPy-1"><span class="toc-text">NumPy</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#分片"><span class="toc-text">分片</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#运算"><span class="toc-text">运算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#轴"><span class="toc-text">轴</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#数据类型"><span class="toc-text">数据类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pandas-1"><span class="toc-text">Pandas</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#分片-1"><span class="toc-text">分片</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#计算相关性，Pearson矩阵相关系数r"><span class="toc-text">计算相关性，Pearson矩阵相关系数r</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#移动元素"><span class="toc-text">移动元素</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#applymap和apply"><span class="toc-text">applymap和apply</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Series和DataFrame相加"><span class="toc-text">Series和DataFrame相加</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#向量运算"><span class="toc-text">向量运算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#分组"><span class="toc-text">分组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#合并多个DataFrame"><span class="toc-text">合并多个DataFrame</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#用散点图展示"><span class="toc-text">用散点图展示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#处理缺失值"><span class="toc-text">处理缺失值</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#三维数据"><span class="toc-text">三维数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#NumPy-2"><span class="toc-text">NumPy</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pandas-2"><span class="toc-text">Pandas</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-text">推荐文章（由hexo文章推荐插件驱动）</span></a>
  </div>
</div>

  
<nav id="pagination">
  
    <a href="../../25/data_analysis_commucating_data_art/" class="prev">&larr; Prev post Data Analysis 数据交流的艺术</a>
  

  

  
    <a href="../../19/data_analysis_different_roles_of_bi_field/" class="next">Next post Data Analysis 商业智能领域里的不同角色 &rarr;</a>
  
</nav>

  <!-- JiaThis Button BEGIN -->

<!-- JiaThis Button END -->


      
      <div id="uyan_frame"></div>
      
      
      
    </div>
  </div>

  <div id="bottom-outer">
    <div id="bottom-inner">
      Site by Reinhard Hsu using
      <a href="http://hexo.io">Hexo</a> & <a href="https://github.com/stiekel/hexo-theme-random">Random</a>
      <br>
      
    </div>
  </div>
</div>

</div>


  <!-- VL BEGIN -->
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script>
<script type="text/javascript">
new Valine({
    el: '#uyan_frame' ,
    notify:false, 
    verify:false, 
    appId: 'TWoEQAlGPJwcRhNfqjKsmBUI-gzGzoHsz',
    appKey: 'cuCvIecOqw2bk7bDoReqTDWj',
    placeholder: 'just go go',
    path:window.location.pathname, 
    avatar:'mm' 
});
</script>
<!-- VL END -->


<div id="user-card">
  <div class="center-field">
    <img class="avatar" src="http://ReinhardHsu.com/images/ReinhardHsu.png">
    <p id="description"></p>
    <ul class="social-icon">
  
  
    <li>
      <a href="https://github.com/ReinhardHsu">
        
          <i class="icon iconfont github">&#xe606;</i>
        
      </a>
    </li>
  
    <li>
      <a href="https://twitter.com/ReinhardHsu">
        
          <i class="icon iconfont twitter">&#xe600;</i>
        
      </a>
    </li>
  
    <li>
      <a href="https://www.facebook.com/reinhardhsu">
        
          <i class="icon iconfont facebook">&#xe604;</i>
        
      </a>
    </li>
  
    <li>
      <a href="https://www.douban.com/people/Reinhaid">
        
          <i class="icon iconfont douban">&#xe60f;</i>
        
      </a>
    </li>
  
    <li>
      <a href="https://www.zhihu.com/people/reinhardhsu">
        
          <i class="icon iconfont zhihu">&#xe60b;</i>
        
      </a>
    </li>
  
    <li>
      <a href="https://www.linkedin.com/in/ReinhardHsu">
        
          <i class="icon iconfont linkedin">&#xe601;</i>
        
      </a>
    </li>
  
</ul>
  </div>
</div>


<div id="btn-view">Hide</div>



  <script>
if(isTriggerAnalytics) {
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?9ddaf4c58daefd4b2d98d95e643549b3";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
}
</script>



  </script>
<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-119133633-1"></script>
<script>
if(isTriggerAnalytics) {
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-119133633-1');
 }
</script>



  
  
    <script src="../../../../js/jquery-2.2.3.min.js"></script>
  
    <script src="../../../../js/vegas.min.js"></script>
  
    <script src="../../../../js/random.js"></script>
  
    <script src="../../../../js/highlight.pack.js"></script>
  
    <script src="../../../../js/jquery.mousewheel.pack.js"></script>
  
    <script src="../../../../js/jquery.fancybox.pack.js"></script>
  
    <script src="../../../../js/jquery.fancybox-thumbs.js"></script>
  
    <script src="../../../../js/plyr.js"></script>
  

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
<script type="text/javascript" async
  src="https://cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<script>

  // fancybox
  var backgroundImages = [];
  
  $('#post').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox') || $(this).parent().hasClass('fancybox-thumb')) return;
      var alt = this.alt || this.title;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'post' + i);
    });
  });
  $(".fancybox").fancybox();

var vegasConfig = {"preload­Image":true,"transition":["slideLeft2","slideRight2","flash2"],"timer":true,"delay":5000,"shuffle":true,"count":28};
var unsplashConfig = {"gravity":"north"};
// is show background images
var turnoffBackgroundImage = false;




var backgroundColor = "D7CCC8";

$(".fancybox-thumb").fancybox({
  prevEffect: 'none',
  nextEffect: 'none',
  helpers: {
    title: {
      type: 'outside'
    },
    thumbs: {
      width: 50,
      height: 50
    }
  }
});

// show video with plyr
$(".video-container iframe").each(function(i){
  var url = $(this).attr('src');
  var id = url.split('/').pop();
  var plyrContainer = document.createElement('div');
  plyrContainer.className = 'plyr';
  var plyrElement = document.createElement('div');
  plyrElement.dataset.videoId = id;
  switch(true) {
    case url.search('youtube.com') >= 0:
      plyrElement.dataset.type = 'youtube';
      break;
    case url.search('vimeo.com') >= 0:
      plyrElement.dataset.type = 'vimeo';
      break;
    default:
      return;
  };
  plyrContainer.appendChild(plyrElement);
  $(this).parent().html(plyrContainer);
});
plyr.setup('.plyr', {iconUrl: '../../../../css/sprite.svg'});
</script>
</body>
</html>

